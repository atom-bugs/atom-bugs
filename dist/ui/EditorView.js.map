{"version":3,"file":"EditorView.js","sourceRoot":"","sources":["../../lib/ui/EditorView.ts"],"names":[],"mappings":"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","sourcesContent":["'use babel';\n/*!\n * Atom Bugs\n * Copyright(c) 2017 Williams Medina <williams.medinaa@gmail.com>\n * MIT Licensed\n */\nimport {\n createIcon,\n createText,\n createButton,\n createElement,\n insertElement\n} from '../element/index';\nimport { BreakpointManager } from '../BreakpointManager';\nimport { EventEmitter }  from 'events';\n\nexport class EditorView {\n\n  private currentEditor: any;\n  private currentBreakMarker: any;\n  private currentExpressionMarker: any;\n  private currentEvaluationMarker: any;\n  private activateExpressionListerner: boolean = true;\n  private breakpointHandler: Function;\n  private expressionHandler: Function;\n  private evaluateHandler: any;\n  private events: EventEmitter;\n\n  constructor (private breakpointManager: BreakpointManager) {\n    this.events = new EventEmitter();\n    this.breakpointHandler = this.breakpointListener.bind(this);\n    this.expressionHandler = this.expressionListener.bind(this);\n  }\n\n  destroy () {\n    this.currentBreakMarker = undefined;\n    this.currentExpressionMarker = undefined;\n    this.currentEvaluationMarker = undefined;\n    this.removeMarkers();\n  }\n\n  didEvaluateExpression (cb: Function) {\n    this.events.on('evaluateExpression', cb);\n  }\n\n  didRequestProperties (cb: Function) {\n    this.events.on('requestProperties', cb);\n  }\n\n  createBreakMarker (editor, lineNumber: number) {\n    this.removeBreakMarker();\n    let range = [[lineNumber - 1, 0], [lineNumber - 1, 0]];\n    this.currentBreakMarker = editor.markBufferRange(range);\n    editor.decorateMarker(this.currentBreakMarker, {\n      type: 'line',\n      class: 'bugs-break-line'\n    })\n  }\n\n  removeMarkers () {\n    this.removeBreakMarker();\n    this.removeExpressionMarker();\n    this.removeEvaluationMarker();\n  }\n\n  removeBreakMarker () {\n    if (this.currentBreakMarker) {\n      this.currentBreakMarker.destroy();\n    }\n  }\n\n  removeExpressionMarker () {\n    if (this.currentExpressionMarker) {\n      this.currentExpressionMarker.destroy();\n    }\n  }\n\n  addFeatures (editor) {\n    // Observe active editor\n    atom.workspace['observeActivePaneItem']((editor) => {\n      if (this.currentEditor && this.currentEditor.editorElement) {\n        // remove breakpoint handler\n        this.currentEditor.editorElement.removeEventListener('click', this.breakpointHandler);\n        this.currentEditor.editorElement.removeEventListener('mousemove', this.expressionHandler);\n        // remove expression evaluator\n      }\n      if (editor && editor.getPath && editor.editorElement) {\n        this.currentEditor = editor;\n        // add breakpoint handler\n        this.currentEditor.editorElement.addEventListener('click', this.breakpointHandler)\n        this.currentEditor.editorElement.addEventListener('mousemove', this.expressionHandler);\n      }\n    })\n  }\n\n  private breakpointListener (e: MouseEvent) {\n    let element = e.target as HTMLElement;\n    if (element.classList.contains('line-number')) {\n      // toggle breakpoints\n      let sourceFile = this.currentEditor.getPath();\n      let lineNumber = Number(element.textContent)\n      let exists = this.breakpointManager.getBreakpoint(sourceFile, lineNumber)\n      if (exists) {\n        this.breakpointManager.removeBreakpoint(exists);\n      } else {\n        let range = [[lineNumber - 1, 0], [lineNumber - 1, 0]]\n        let marker = this.currentEditor.markBufferRange(range)\n        let decorator = this.currentEditor.decorateMarker(marker, {\n          type: 'line-number',\n          class: 'bugs-breakpoint'\n        })\n        this.breakpointManager.addBreakpoint(marker, lineNumber, sourceFile)\n      }\n    }\n  }\n\n  private getPositionFromEvent (e: MouseEvent) {\n    let lines = this.currentEditor.editorElement.querySelector('.lines');\n    var clientX = e.clientX;\n    var clientY = e.clientY;\n    let clientRect = lines.getBoundingClientRect();\n    let screenPosition = this.currentEditor.screenPositionForPixelPosition({\n      top: (clientY - clientRect.top) + this.currentEditor.editorElement.getScrollTop(),\n      left: (clientX - clientRect.left) + this.currentEditor.editorElement.getScrollLeft()\n    });\n    return this.currentEditor.bufferPositionForScreenPosition(screenPosition);\n  }\n\n  private getWordRangeFromPosition (position) {\n    let prevRow = this.currentEditor.buffer.previousNonBlankRow(position.row);\n    let endRow = this.currentEditor.buffer.nextNonBlankRow(position.row);\n    if (!endRow) {\n      endRow = position.row;\n    }\n    let startWord = position;\n    let endWord = position;\n    this.currentEditor.scanInBufferRange(/[ \\,\\{\\}\\(\\;\\)\\[\\]^\\n]+/gm, [[prevRow, 0], position], (s) => {\n      if (s.matchText) {\n        startWord = s.range.end;\n      }\n    })\n    this.currentEditor.scanInBufferRange(/[ \\,\\{\\}\\(\\.\\;\\)\\[\\]\\n]+/g, [position, [endRow, 50]], (s) => {\n      if (s.matchText) {\n        endWord = s.range.start;\n        s.stop();\n      }\n    })\n    return [startWord, endWord];\n  }\n\n  private expressionListener (e: MouseEvent) {\n    if (this.activateExpressionListerner) {\n      let sourceFile = this.currentEditor.getPath();\n      let bufferPosition = this.getPositionFromEvent(e);\n      let scanRange = this.getWordRangeFromPosition(bufferPosition);\n      let expression = this.currentEditor.getTextInBufferRange(scanRange);\n      clearTimeout(this.evaluateHandler)\n      this.evaluateHandler = setTimeout(() => {\n        if (expression && String(expression).trim().length > 0) {\n          this.events.emit('evaluateExpression', expression, scanRange);\n        }\n      }, 500);\n    }\n  }\n  createInspectorForElement (element: HTMLElement, result: any, load?: boolean) {\n    // value\n    if (!load) {\n      console.log('result', result);\n      let value = result.value;\n      let valueClass = 'syntax--other';\n      if (value === null) {\n        value = 'null';\n      }\n      if (value === undefined) {\n        value = 'undefined';\n      }\n      switch(result.type) {\n        case 'string':\n          value = `\"${value}\"`;\n          valueClass = 'syntax--string';\n          break;\n        case 'number':\n          value = result.value;\n          valueClass = 'syntax--constant syntax--numeric';\n          break;\n        case 'object':\n          value = result.description || result.className || value;\n          if (result.subtype) {\n            valueClass = 'syntax--other';\n          } else {\n            valueClass = 'syntax--support syntax--class';\n          }\n          break;\n        case 'function':\n          value = 'function';//result.className;\n          valueClass = 'syntax--keyword';\n          // valueClass = 'syntax--entity syntax--name syntax--function';\n          break;\n      }\n      insertElement(element, [\n        createElement('span', {\n          className: valueClass,\n          elements: [createText(value)]\n        })\n      ]);\n    }\n    // object\n    if (result.objectId) {\n      let loadProperties = () => {\n        this.events.emit('requestProperties', result, {\n          insertFromDescription: (descriptions: Array<any>) => {\n            let propertiesElement = createElement('section', {\n              className: 'property-properties'\n            })\n            insertElement(element, [propertiesElement]);\n            descriptions.forEach((desc) => {\n              if (desc.value) {\n                let valueElement = createElement('span', {\n                  className: 'property-value'\n                });\n                let propertyClass = 'property-name';\n                if (desc.enumerable === false) {\n                  propertyClass += ' syntax--comment';\n                } else {\n                  propertyClass += ' syntax--variable';\n                }\n                insertElement(propertiesElement, [\n                  createElement('atom-bugs-inspector-item', {\n                    elements: [\n                      createElement('i', { className: 'bugs-icon' }),\n                      createElement('span', {\n                        className: propertyClass,\n                        elements: [ createText(`${desc.name}:`) ]\n                      }),\n                      valueElement\n                    ]\n                  })\n                ]);\n                this.createInspectorForElement(valueElement, desc.value, false);\n              }\n            });\n          }\n        })\n      }\n      if (load === true) {\n        loadProperties();\n      } else {\n        let item = element.parentElement;\n        let request = true;\n        let icon = item.querySelector('.bugs-icon');\n        if (icon) {\n          icon.classList.add('bugs-icon-arrow-right');\n          icon.addEventListener('click', (e) => {\n            let properties = item.querySelector('.property-properties') as HTMLElement;\n            if (icon.classList.contains('bugs-icon-arrow-right')) {\n              icon.classList.add('active');\n              icon.classList.remove('bugs-icon-arrow-right');\n              icon.classList.add('bugs-icon-arrow-down');\n              if (request) {\n                loadProperties();\n              } else {\n                properties.style.display = null;\n              }\n              request = false;\n            } else {\n              icon.classList.remove('active');\n              icon.classList.remove('bugs-icon-arrow-down');\n              icon.classList.add('bugs-icon-arrow-right');\n              properties.style.display = 'none';\n            }\n          })\n        }\n      }\n    }\n  }\n  createInspectorOverlay (result: any) {\n    let element = createElement('atom-bugs-overlay', {\n      className: 'native-key-bindings'\n    });\n    let inspectorElement = createElement('atom-bugs-inspector');\n    element.setAttribute('tabindex', '0');\n    inspectorElement.addEventListener('mousewheel', (e) => {\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n    });\n    this.createInspectorForElement(inspectorElement, result, true);\n    return insertElement(element, [\n      createElement('atom-bugs-overlay-header', {\n        elements: [ createText(result.className || result.type) ]\n      }),\n      inspectorElement\n    ]);\n  }\n  addEvaluationMarker (result: any, range) {\n    // highlight expression\n    this.removeExpressionMarker();\n    this.currentExpressionMarker = this.currentEditor.markBufferRange(range)\n    this.currentEditor.decorateMarker(this.currentExpressionMarker, {\n      type: 'highlight',\n      class: 'bugs-expression'\n    })\n    // overlay inspector\n    this.removeEvaluationMarker();\n    let element = this.createInspectorOverlay(result);\n    this.currentEvaluationMarker = this.currentEditor.markBufferRange(range);\n    this.currentEditor.decorateMarker(this.currentEvaluationMarker, {\n      type: 'overlay',\n      class: 'bugs-expression-overlay',\n      item: element\n    });\n    setTimeout(() => {\n      // element.focus();\n      // element.addEventListener('blur', () => {\n      //   this.removeEvaluationMarker();\n      // })\n      element.addEventListener('mouseenter', () => {\n        this.activateExpressionListerner = false;\n        element.addEventListener('mouseleave', () => {\n          this.activateExpressionListerner = true;\n          // this.removeEvaluationMarker();\n        })\n      })\n    }, 0);\n    // wait to attach element\n    // setTimeout(() => {\n    //   // let overlay = element.parentElement;\n    //   // overlay.addEventListener('mouseenter', () => {\n    //   //   clearTimeout(this.evaluateHandler);\n    //   //   overlay.addEventListener('mouseout', () => {\n    //   //     this.removeEvaluationMarker();\n    //   //   });\n    //   // });\n    // }, 100);\n  }\n  removeEvaluationMarker () {\n    if (this.currentEvaluationMarker) {\n      this.currentEvaluationMarker.destroy();\n      this.currentEvaluationMarker = undefined;\n    }\n  }\n}\n"]}