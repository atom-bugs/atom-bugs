{"version":3,"file":"editor-manager.js","sourceRoot":"","sources":["../../src/editor/editor-manager.ts"],"names":[],"mappings":"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","sourcesContent":["'use babel'\n/*!\n * Atom Bugs\n * Copyright(c) 2017 Williams Medina <williams.medinaa@gmail.com>\n * MIT Licensed\n */\nimport {\n createIcon,\n createText,\n createButton,\n createElement,\n insertElement,\n attachEventFromObject\n} from '../element/index'\n\nimport { BreakpointManager, Breakpoint, Breakpoints } from './breakpoint-manager'\nimport { PluginManager } from '../plugin/index'\nimport { InspectorView } from '../inspector/index'\nimport { EventEmitter }  from 'events'\nimport { get } from 'lodash'\n\nexport interface EditorOptions {\n  pluginManager: PluginManager,\n  didAddBreakpoint?: Function,\n  didRemoveBreakpoint?: Function,\n  didBreak?: Function,\n  didChange?: Function\n}\n\nexport class EditorManager {\n\n  private currentEditor: any\n\n  private currentBreakMarker: any\n  private currentExpressionMarker: any\n  private currentEvaluationMarker: any\n\n  private activateExpressionListerner: boolean = true\n  private evaluateHandler: any\n\n  private breakpointManager: BreakpointManager\n  private pluginManager: PluginManager\n  private events: EventEmitter\n\n  constructor (options: EditorOptions) {\n    this.events = new EventEmitter()\n    this.breakpointManager = new BreakpointManager()\n    this.pluginManager = options.pluginManager\n    attachEventFromObject(this.events, [\n      'didAddBreakpoint',\n      'didRemoveBreakpoint',\n      'didBreak',\n      'didChange'\n    ], options)\n  }\n\n  restoreBreakpoints (breakpoints: Breakpoints) {\n    breakpoints.forEach(({filePath, lineNumber}) => {\n      let marker\n      if (get(this, 'currentEditor.getPath') && filePath === this.currentEditor.getPath()) {\n        marker = this.createBreakpointMarkerForEditor(this.currentEditor, lineNumber)\n      }\n      this.breakpointManager.addBreakpoint(marker, lineNumber, filePath)\n      this.events.emit('didAddBreakpoint', filePath, lineNumber)\n    })\n  }\n\n  getBreakpoints (): Breakpoints {\n    return this.breakpointManager.getBreakpoints()\n  }\n\n  getPlainBreakpoints (): Breakpoints {\n    return this.breakpointManager.getPlainBreakpoints()\n  }\n\n  destroy () {\n    this.currentBreakMarker = undefined\n    this.currentExpressionMarker = undefined\n    this.currentEvaluationMarker = undefined\n    this.removeMarkers()\n  }\n\n  breakOnFile (filePath: string, lineNumber: number) {\n    // this.createConsoleLine('', [\n    //   createText('Break on'),\n    //   createText(`${filePath}:${lineNumber}`)\n    // ])\n    this.events.emit('didBreak', filePath, lineNumber)\n  }\n\n  createBreakMarker (editor, lineNumber: number) {\n    this.removeBreakMarker()\n    let range = [[lineNumber, 0], [lineNumber, 0]]\n    this.currentBreakMarker = editor.markBufferRange(range)\n    editor.decorateMarker(this.currentBreakMarker, {\n      type: 'line',\n      class: 'bugs-break-line'\n    })\n  }\n\n  removeMarkers () {\n    this.removeBreakMarker()\n    this.removeExpressionMarker()\n    this.removeEvaluationMarker()\n  }\n\n  removeBreakMarker () {\n    if (this.currentBreakMarker) {\n      this.currentBreakMarker.destroy()\n    }\n  }\n\n  removeExpressionMarker () {\n    if (this.currentExpressionMarker) {\n      this.currentExpressionMarker.destroy()\n    }\n  }\n\n  async addFeatures (editor) {\n    // restore breakpoints\n    if (get(editor, 'getPath', false)) {\n      let sourceFile = editor.getPath()\n      let breakpoints = await this.breakpointManager.getBreakpointsFromFile(sourceFile)\n      breakpoints.forEach((breakpoint: Breakpoint) => {\n        if (breakpoint.marker) breakpoint.marker.destroy()\n        breakpoint.marker = this.createBreakpointMarkerForEditor(editor, breakpoint.lineNumber)\n      })\n    }\n    this.currentEditor = editor\n    if (get(editor, 'editorElement.addEventListener', false) &&\n      !get(editor, 'editorElement.__atomBugsEnabledFeatures', false)) {\n      let breakpointHandler = (e) => this.listenBreakpoints(e, editor)\n      let expressionHandler = (e) => this.listenExpressionEvaluations(e, editor)\n      // add breakpoint handler\n      editor.editorElement.__atomBugsEnabledFeatures = true\n      editor.editorElement.addEventListener('click', breakpointHandler)\n      editor.editorElement.addEventListener('mousemove', expressionHandler)\n      editor.onDidDestroy(() => {\n        editor.editorElement.removeEventListener('click', breakpointHandler)\n        editor.editorElement.removeEventListener('mousemove', expressionHandler)\n      })\n    }\n  }\n\n  private listenBreakpoints (e: MouseEvent, editor: any) {\n    let element = e.target as HTMLElement\n    if (element.classList.contains('line-number')) {\n      // toggle breakpoints\n      let sourceFile = editor.getPath()\n      let lineNumber = Number(element.textContent) - 1\n      let exists = this.breakpointManager.getBreakpoint(sourceFile, lineNumber)\n      if (exists) {\n        this\n          .breakpointManager\n          .removeBreakpoint(exists)\n          .then(() => {\n            this.events.emit('didRemoveBreakpoint', sourceFile, lineNumber)\n            this.pluginManager.removeBreakpoint(sourceFile, lineNumber)\n          })\n      } else {\n        let marker = this.createBreakpointMarkerForEditor(editor, lineNumber)\n        this\n          .breakpointManager\n          .addBreakpoint(marker, lineNumber, sourceFile)\n          .then(() => {\n            this.events.emit('didAddBreakpoint', sourceFile, lineNumber)\n            this.pluginManager.addBreakpoint(sourceFile, lineNumber)\n          })\n      }\n      this.events.emit('didChange')\n    }\n  }\n\n  private createBreakpointMarkerForEditor (editor: any, lineNumber: any) {\n    let range = [[lineNumber, 0], [lineNumber, 0]]\n    let marker = editor.markBufferRange(range)\n    let decorator = editor.decorateMarker(marker, {\n      type: 'line-number',\n      class: 'bugs-breakpoint'\n    })\n    return marker\n  }\n\n  private getEditorPositionFromEvent (editor, e: MouseEvent) {\n    let lines = editor.editorElement.querySelector('.lines')\n    var clientX = e.clientX\n    var clientY = e.clientY\n    let clientRect = lines.getBoundingClientRect()\n    let screenPosition = editor.editorElement.screenPositionForPixelPosition({\n      top: (clientY - clientRect.top) + editor.editorElement.getScrollTop(),\n      left: (clientX - clientRect.left) + editor.editorElement.getScrollLeft()\n    })\n    return editor.bufferPositionForScreenPosition(screenPosition)\n  }\n\n  private getEditorWordRangeFromPosition (editor, position) {\n    let prevRow = editor.buffer.previousNonBlankRow(position.row)\n    let endRow = editor.buffer.nextNonBlankRow(position.row)\n    if (!endRow) {\n      endRow = position.row\n    }\n    let startWord = position\n    let endWord = position\n    // /\\()\"':,.<>~!@#$%^&*|+=[]{}`?-…\n    editor.scanInBufferRange(/[ \\,\\{\\}\\(\\\\)\\[\\]^\\n]+/gm, [[prevRow, 0], position], (s) => {\n      if (s.matchText) {\n        startWord = s.range.end\n      }\n    })\n    editor.scanInBufferRange(/[ \\,\\{\\}\\(\\.\\\\)\\[\\]\\:\\/\\n]+/g, [position, [endRow, 50]], (s) => {\n      if (s.matchText) {\n        endWord = s.range.start\n        s.stop()\n      }\n    })\n    return [startWord, endWord]\n  }\n\n  private listenExpressionEvaluations (e: MouseEvent, editor: any) {\n    if (this.activateExpressionListerner) {\n      let sourceFile = editor.getPath()\n      let bufferPosition = this.getEditorPositionFromEvent(editor, e)\n      let scanRange = this.getEditorWordRangeFromPosition(editor, bufferPosition)\n      let expression = editor.getTextInBufferRange(scanRange)\n      clearTimeout(this.evaluateHandler)\n      this.evaluateHandler = setTimeout(() => {\n        if (expression && String(expression).trim().length > 0) {\n          let evaluationView = this.createEditorEvaluationView(editor, scanRange)\n          this\n            .pluginManager\n            .evaluateExpression(expression, evaluationView)\n        }\n      }, 500)\n    }\n  }\n\n  createEditorEvaluationView (editor: any, range: any) {\n    return {\n      insertFromResult: (result) => {\n        this.addEditorEvaluationMarker(editor, result, range)\n      }\n    }\n  }\n\n  createInspectorOverlay (result: any) {\n    let element = createElement('atom-bugs-overlay', {\n      className: 'native-key-bindings'\n    })\n    element.setAttribute('tabindex', '0')\n    let inspector = new InspectorView({\n      result,\n      didRequestProperties: (result, inspectorView) => {\n        this.pluginManager.requestProperties(result, inspectorView)\n      }\n    })\n    return insertElement(element, [\n      createElement('atom-bugs-overlay-header', {\n        elements: [ createText(result.className || result.type) ]\n      }),\n      inspector.getElement()\n    ])\n  }\n\n  addEditorEvaluationMarker (editor: any, result: any, range) {\n    // highlight expression\n    this.removeExpressionMarker()\n    this.currentExpressionMarker = editor.markBufferRange(range)\n    editor.decorateMarker(this.currentExpressionMarker, {\n      type: 'highlight',\n      class: 'bugs-expression'\n    })\n    // overlay inspector\n    this.removeEvaluationMarker()\n    let element = this.createInspectorOverlay(result)\n    this.currentEvaluationMarker = editor.markBufferRange(range)\n    editor.decorateMarker(this.currentEvaluationMarker, {\n      type: 'overlay',\n      class: 'bugs-expression-overlay',\n      item: element\n    })\n    setTimeout(() => {\n      let close = () => {\n        this.activateExpressionListerner = true\n        this.removeEvaluationMarker()\n      }\n      // let autoClose = setTimeout(close, 15000)\n      element.addEventListener('mouseenter', () => {\n        // clearTimeout(autoClose)\n        this.activateExpressionListerner = false\n        element.addEventListener('mouseleave', () => close())\n      })\n    }, 0)\n  }\n\n  removeEvaluationMarker () {\n    if (this.currentEvaluationMarker) {\n      this.currentEvaluationMarker.destroy()\n      this.currentEvaluationMarker = undefined\n    }\n  }\n}\n"]}