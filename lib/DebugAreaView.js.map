{"version":3,"file":"DebugAreaView.js","sourceRoot":"","sources":["../src2/DebugAreaView.ts"],"names":[],"mappings":"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","sourcesContent":["'use babel';\n/*!\n * XAtom Debug\n * Copyright(c) 2017 Williams Medina <williams.medinaa@gmail.com>\n * MIT Licensed\n */\n\nconst { CompositeDisposable, Emitter, Disposable } = require('atom');\nimport { View, ViewElement } from './View';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { spawn as spawnPty } from 'node-pty';\nimport Terminal from 'xterm';\n\nconst path = require('path');\nTerminal.loadAddon('fit');\n\nexport const DEBUG_AREA_URI = 'xatom://debug-area';\n\n@View({\n  name: 'xatom-debug-area'\n})\nexport class DebugAreaView {\n  private resizeObserver: any;\n  private resizeHandler: any;\n  private terminal: any;\n  private pty: any;\n  public element: HTMLElement;\n  public emitter = new Emitter();\n  constructor(private viewElement: ViewElement) {\n    this.element = this.getElement();\n  }\n  elementDidResize () {\n    clearTimeout(this.resizeHandler);\n    this.resizeHandler = setTimeout(() => {\n      if (this.terminal) {\n        this.terminal.fit();\n        if(this.pty) this.pty.resize(this.terminal.cols, this.terminal.rows);\n      };\n    }, 250);\n  }\n  onDidExitProcess (cb) {\n    return this.emitter.on('didExitProccess', cb);\n  }\n  showInitialMessage () {\n    const date = new Date().toString();\n    this.terminal.writeln(`\\x1b[1m\\x1b[90mXAtom: Debugger v1.6.11\\x1b[0m\\x1b[0m`);\n    this.terminal.writeln(`\\x1b[1m\\x1b[90m${date}\\x1b[0m\\x1b[0m`);\n  }\n  startProcess (command: string, args?: string[], options?: any) {\n    const projectPaths = atom.project.getPaths();\n    const defaultOptions = {\n      name: 'xterm-color',\n      cwd: path.resolve(process.env.HOME),\n      env: Object.assign({}, process.env, {\n        TERM: 'xterm-256color',\n        CLICOLOR: '1',\n        LSCOLORS: 'ExFxCxDxBxegedabagacad'\n      })\n    };\n    this.pty = spawnPty(command,\n      args || [],\n      Object.assign(defaultOptions, options));\n    this.terminal = new Terminal();\n    this.terminal.open(this.getElement(), true);\n    this.terminal.on('data', (data) => {\n      return this.pty.write(data);\n    });\n    this.showInitialMessage();\n\n    this.element.addEventListener('focus', () => this.terminal.focus());\n    this.resizeObserver = new ResizeObserver(this.elementDidResize.bind(this));\n    this.resizeObserver.observe(this.element);\n\n    this.pty.on('data', (data) => {\n      return this.terminal.write(data);\n    });\n    this.pty.on('exit', () => {\n      this.emitter.emit('didExitProccess')\n      this.destroy();\n    });\n    return this.pty;\n  }\n  destroy () {\n    if (this.resizeObserver) this.resizeObserver.disconnect();\n    if (this.pty) this.pty.kill();\n    if (this.terminal) this.terminal.destroy();\n    this.pty = null;\n  }\n  clear () {\n    this.terminal.clear();\n  }\n  copySelection () {\n    let selectedText = window.getSelection().toString();\n    let preparedText = this.formatText(selectedText);\n    atom.clipboard.write(preparedText);\n  }\n  pasteFromClipboard () {\n    let text = atom.clipboard.read();\n    this.pty.write(text);\n  }\n  formatText (text: string) {\n    const space = String.fromCharCode(32);\n    const nonBreakingSpace = String.fromCharCode(160);\n    const allNonBreakingSpaces = new RegExp(nonBreakingSpace, 'g');\n    return text.split('\\n').map((line) => {\n      return line.replace(/\\s+$/g, '').replace(allNonBreakingSpaces, space);\n    }).join('\\n');\n  }\n  getDefaultLocation () {\n    return 'bottom';\n  }\n  getAllowedLocations () {\n    return ['bottom', 'top', 'center'];\n  }\n  getElement () {\n    return this.viewElement.element;\n  }\n  getURI () {\n    return DEBUG_AREA_URI;\n  }\n  getTitle() {\n    return 'Debug Area';\n  }\n}\n"]}